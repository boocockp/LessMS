<link rel="import" href="../bower/polymer/polymer.html">

<dom-module id="location-file-namer">
    <template>
        <div>
            <h3 class="h3">{{fileBasePath}}<span>/</span> <input id="fileName" type="text" value="{{fileName::input}}"></h3>
        </div>
    </template>
</dom-module>

<script>
    var UUID_REGEX = '[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}';
    var REGION_REGEX = '[a-z]{2}-[a-z]+-\\d';
    var ID_REGEX = REGION_REGEX + ':' + UUID_REGEX;

    function getQueryParameters() {
        var query = location.search.substr(1);
        var result = {};
        query.split("&").forEach(function(part) {
            var item = part.split("=");
            result[item[0]] = decodeURIComponent(item[1]);
        });
        return result;
    }

    Polymer({
        is: 'location-file-namer',

        properties: {
            fileBasePath: {
                type: String,
                readOnly: true,
                notify: true
            },

            contentType: {
                type: String,
                readOnly: true,
                notify: true
            },

            filePath: {
                type: String,
                readOnly: true,
                notify: true
            },

            fileName: {
                type: String,
                notify: true,
                observer: '_fileNameChanged'
            }
        },

        ready: function () {
            this._setFileBasePath(this.computeFileBasePath());
            this._setContentType(this.computeContentType());
        },

        _fileNameChanged: function(fileName) {
            this._setFilePath(this.fileBasePath + '/' + fileName);
        },

        computeFileBasePath: function () {
            var path = getQueryParameters().fileBasePath;
            path = path.replace(new RegExp(ID_REGEX + '/'), '');
            return path;
        },

        computeContentType: function () {
            return getQueryParameters().contentType;
        }
    });
</script>
