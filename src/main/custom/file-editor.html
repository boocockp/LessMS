<link rel="import" href="../bower/polymer/polymer.html">
<link rel="import" href="ace-editor.html">
<link rel="import" href="html-editor.html">
<link rel="import" href="json-editor.html">
<link rel="import" href="image-editor.html">

<dom-module id="file-editor">
    <template>
        <style>
            #editorContainer {
                /*width: 100%;*/
                /*min-height: 100px;*/
                margin-bottom: 25px;
            }
        </style>
        <div id="editorContainer">
        </div>
        <div>
            <button on-click="save">Save</button>
            <button on-click="close">Close</button>
        </div>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'file-editor',

        properties: {
            fileData: {
                type: String
            },

            contentType: {
                type: String
            },

            savedFileData: {
                type: String,
                readOnly: true,
                notify: true
            }
        },

        observers: [
            '_updateEditor(fileData, contentType)'
        ],


        ready: function() {
        },

        _updateEditor: function() {
            var comp = this;
            this._createEditorElement().then(function (editorElement) {
                editorElement.id = "editor";
                comp.$.editorContainer.appendChild(editorElement);
                editorElement.fileData = this.fileData;
                editorElement.contentType = this.contentType;

            });
        },

        _createEditorElement: function() {
            if (this.contentType == "application/json") {
                return this._findSchema().then(function(schema) {
                    if (schema) {
                        var editor = document.createElement("json-editor");
                        editor.schema = schema;
                        return editor;
                    } else {
                        return document.createElement("ace-editor");
                    }
                });
            } else {
                var editorType = this.editorTypes[type] || "ace-editor";
                return Promise.resolve(document.createElement(editorType));
            }

        },

        _findSchema: function() {
            return Promise.resolve(testSchema);
        },

        save: function() {
            console.log('Save');
            this._setSavedFileData(this.editorElement.getFileData());
        },

        close: function() {
            console.log('Close');

        },

        editorTypes: {
            "text/html": "html-editor",
            "image/jpeg": "image-editor"
        }

    });

    var testSchema =
    {
        "title": "Person",
        "type": "object",
        "properties": {
            "name": {
                "type": "string",
                "description": "First and Last name",
                "minLength": 4,
                "default": "Mickey"
            },
            "age": {
                "type": "integer",
                "default": 25,
                "minimum": 18,
                "maximum": 99
            },
            "favorite_color": {
                "type": "string",
                "format": "color",
                "title": "favorite color",
                "default": "#aabbcc"
            },
            "gender": {
                "type": "string",
                "enum": [
                    "male",
                    "female", "unspecified"
                ]
            }
        }
    };

</script>
