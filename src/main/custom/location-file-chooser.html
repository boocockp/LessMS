<link rel="import" href="../bower/polymer/polymer.html">

<dom-module id="location-file-chooser">
    <template>
        <h3>{{filePath}}</h3>
    </template>
</dom-module>

<script>
    var UUID_REGEX = '[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}';
    var REGION_REGEX = '[a-z]{2}-[a-z]+-\\d';
    var ID_REGEX = REGION_REGEX + ':' + UUID_REGEX;

    Polymer({
        is: 'location-file-chooser',

        properties: {
            filePath: {
                type: String,
                readOnly: true,
                notify: true
            },

            fileUrl: {
                type: String,
                readOnly: true,
                notify: true
            },

            bucketName: {
                type: String
            }
        },

        ready: function() {
            this._setFilePath(this.computeFilePath());
            this._setFileUrl(this.computeFileUrl());
        },

        computeFilePath: function() {
            var parser = document.createElement('a');
            parser.href = this.computeFileUrl();
            var path = parser.pathname.substring(1);
            path = path.replace(new RegExp(this.bucketName + '/'), '');
            path = path.replace(new RegExp(ID_REGEX + '/'), '');
            path = decodeURIComponent(path);
            return path;
        },

        computeFileUrl: function() {
            return decodeURIComponent(location.search.split('=')[1]);
        }
    });
</script>
